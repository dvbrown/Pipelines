lociSubset="""2:209100952-209118910 2:209100952-209119170 2:209100952-209119806 4:15969848-16077741 4:15969848-16085594 4:15969848-16085623 4:15969848-16077741 4:15969848-16077741 4:15969848-16077741 4:15969848-16077741 4:54243819-55164412 4:55095263-55131516 4:55095263-55148145 4:55095263-55164412 4:55143342-55148145 4:16004889-16077741 4:55095263-55146925 7:55086724-55224644 7:55086724-55236328 7:55086724-55238738 7:55086724-55275031 7:55220082-55220357 7:55232972-55233846 7:55086724-55270769 7:55177539-55275031 7:55224225-55238906 7:55224225-55238906 7:55086724-55270769 7:55086724-55275031 7:55248978-55259567 X:76760355-77041719 X:76760355-77041719 X:76760355-77041719 X:76909587-77041719 X:76937011-77041719 X:76937011-77041719 1:89623194-89728532 1:131265453-131565783 1:89623194-89728532 1:35160416-35253949 1:35160416-35253949 1:35160416-35253949 1:35160416-35253949 1:35160416-35253949 1:35160416-35253949 1:35160416-35253949 1:35160416-35253949 1:35211381-35236461 1:35211381-35236461 1:35211381-35236461 1:35160416-35244867 1:58141509-58146230 1:58141509-58146230 1:58141509-58146230 1:90627211-90645708 1:90627211-90643927 1:90627211-90645708 1:7565096-7579937 1:7569403-7579937 1:7571719-7578811 1:7571719-7590868 1:7571719-7590868 1:7577498-7590868 1:7577498-7590868 1:29421944-29546377 1:29421944-29549782 1:29421944-29704695 1:29421944-29704695 1:29552100-29658922 1:7571719-7576926 1:7571719-7578811 1:7571719-7578811 1:7571719-7590868 1:7571719-7590868 1:7577498-7578554 1:7579311-7590868 1:29483000-29579822 1:29592246-29704695 1:7577850-7590868 1:29664836-29687721 1:29664836-29708905 1:7571719-7579937 1:7571719-7590868"""


subsetBam  = {
  doc title: "Subset a bam file for a set of genomic reigons."
    desc: """You may specify one or more space-separated region specifications after the input filename to restrict output to only those alignments which overlap the specified region(s). Use of region specifications requires a coordinate-sorted and indexed input file (in BAM or CRAM format). 
    
    Regions can be specified as: RNAME[:STARTPOS[-ENDPOS]] and all position coordinates are 1-based. 
	Examples of region specifications: `chr2:1000000'
"""
  exec """samtools view -h1 $input.bam $lociSubset > $output.bam
"""
}

  sortBam = {
    doc title: "Sort the bam file by coordinate"
    exec "exec samtools sort $input.subsetBam.bam > $output.bam"
  }

  indexBam = {
  exec """samtools index $input.subsetBam.sortBam.bam"""
  }

Bpipe.run { "test.bam" * [subsetBam + sortBam + indexBam] }
